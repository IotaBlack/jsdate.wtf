<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JS Date WTF - The JavaScript Date Quiz</title>
  <style>
    :root {
      --wong-orange: #E69F00;
      --wong-orange-dark: #CC8800;
      --wong-sky-blue: #56B4E9;
      --wong-bluish-green: #009E73;
      --wong-yellow: #F0E442;
      --wong-blue: #0072B2;
      --wong-blue-dark: #005A8F;
      --wong-vermillion: #D55E00;
      --wong-red-purple: #CC79A7;
      --wong-black: #000000;
      --wong-grey: #999999;

      --gray-50: #F5F5F5;
      --gray-100: #E5E5E5;
      --gray-200: #D4D4D4;
      --gray-300: #B0B0B0;
      --gray-400: #737373;
      --gray-500: #525252;
      --gray-600: #404040;
      --gray-700: #2A2A2A;
      --gray-800: #1A1A1A;
      --gray-900: #0F0F0F;

      --white: #FFFFFF;
      --black: #000000;
    }

    :root {
      --color-primary: var(--wong-orange);
      --color-primary-hover: var(--wong-orange-dark);
      --color-secondary: var(--wong-blue);
      --color-secondary-hover: var(--wong-blue-dark);

      --color-bg-dark: var(--gray-900);
      --color-bg-medium: var(--gray-800);
      --color-bg-light: var(--gray-700);
      --color-bg-lighter: var(--gray-600);

      --color-text-primary: var(--gray-50);
      --color-text-secondary: var(--gray-300);

      --color-border: var(--gray-600);
      --color-border-hover: var(--gray-500);
      --color-border-light: var(--gray-500);

      --color-error: var(--wong-vermillion);
      --color-correct-bg: rgba(0, 158, 115, 0.15);
      --color-incorrect-bg: rgba(213, 94, 0, 0.15);
      --color-accent-green: var(--wong-bluish-green);
      --color-code-bg: var(--gray-900);

      --shadow-strength: 0.5;

      --syntax-keyword: var(--wong-sky-blue);
      --syntax-string: var(--wong-bluish-green);
      --syntax-number: var(--wong-yellow);
      --syntax-operator: var(--gray-300);
      --syntax-function: var(--wong-orange);
      --syntax-comment: var(--gray-300);

      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 12px;
      --spacing-lg: 15px;
      --spacing-xl: 20px;
      --spacing-2xl: 25px;
      --spacing-3xl: 30px;
      --spacing-4xl: 40px;

      --font-system: Avenir, Montserrat, Corbel, 'URW Gothic', source-sans-pro, sans-serif;
      --font-mono: ui-monospace, 'Cascadia Code', 'Source Code Pro', Menlo, Consolas, 'DejaVu Sans Mono', monospace;
      --font-size-sm: 0.9em;
      --font-size-base: 1em;
      --font-size-lg: 1.1em;
      --font-size-xl: 2em;
      --font-size-2xl: 2.5em;
      --font-size-3xl: 3em;
      --line-height: 1.6;

      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;

      --shadow-default: 0 4px 20px rgba(0, 0, 0, var(--shadow-strength));
      --shadow-subtle: 0 2px 8px rgba(0, 0, 0, calc(var(--shadow-strength) * 0.6));

      --container-max-width: 600px;

      --border-thin: 1px;
      --border-medium: 2px;
      --border-thick: 4px;

      --option-key-size: 30px;
    }

    [data-theme="light"] {
      --color-primary: var(--wong-orange-dark);
      --color-primary-hover: #B36A00;
      --color-secondary: var(--wong-blue-dark);
      --color-secondary-hover: #004A7A;

      --color-bg-dark: var(--white);
      --color-bg-medium: #F7F7F7;
      --color-bg-light: var(--gray-100);
      --color-bg-lighter: var(--gray-200);

      --color-text-primary: var(--gray-800);
      --color-text-secondary: var(--gray-400);

      --color-border: var(--gray-200);
      --color-border-hover: var(--gray-300);
      --color-border-light: var(--gray-100);

      --color-error: var(--wong-vermillion);
      --color-correct-bg: rgba(0, 158, 115, 0.1);
      --color-incorrect-bg: rgba(213, 94, 0, 0.1);
      --color-accent-green: var(--wong-bluish-green);
      --color-code-bg: var(--gray-50);

      --shadow-strength: 0.15;

      --syntax-keyword: var(--wong-blue);
      --syntax-string: var(--wong-bluish-green);
      --syntax-number: var(--wong-orange-dark);
      --syntax-operator: var(--gray-300);
      --syntax-function: var(--wong-orange-dark);
      --syntax-comment: var(--gray-400);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-system);
      background-color: var(--color-bg-dark);
      color: var(--color-text-primary);
      height: 100vh;
      /* Fallback for older browsers */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: var(--spacing-xl);
      line-height: var(--line-height);
      overflow: hidden;
    }

    /* Use dynamic viewport height when supported */
    @supports (height: 100dvh) {
      body {
        height: 100dvh;
      }
    }

    .container {
      max-width: 800px;
      width: 100%;
      height: 100vh;
      /* Fallback for older browsers */
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* Screen layouts */
    #startScreen,
    #quizScreen,
    #resultsScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      /* Fallback for older browsers */
      padding: var(--spacing-xl);
    }

    /* Use dynamic viewport height when supported */
    @supports (height: 100dvh) {

      .container,
      #startScreen,
      #quizScreen,
      #resultsScreen {
        height: 100dvh;
      }
    }

    /* Start screen - center everything vertically */
    #startScreen {
      justify-content: center;
      gap: var(--spacing-2xl);
    }

    /* Quiz screen - single flexbox with positioned elements */
    #quizScreen {
      justify-content: flex-start;
      gap: var(--spacing-lg);
    }

    /* Results screen - center everything vertically */
    #resultsScreen {
      justify-content: center;
      gap: var(--spacing-2xl);
    }

    /* Hide screens by default */
    #startScreen.hidden,
    #quizScreen.hidden,
    #resultsScreen.hidden {
      display: none;
    }

    /* Header styling */
    header {
      text-align: center;
    }

    /* Progress stays at top */
    .progress {
      align-self: flex-start;
      width: 100%;
    }

    /* Options container takes available width */
    .options {
      align-self: stretch;
      width: 100%;
      margin-top: auto;
    }

    /* Button stays at bottom with consistent space */
    #nextButton {
      align-self: center;
      visibility: hidden;
      /* Use visibility instead of display to maintain space */
    }

    #nextButton:not(.hidden) {
      visibility: visible;
    }

    #nextButton.hidden {
      visibility: hidden;
      display: block;
    }

    h1 {
      font-size: 4rem;
      color: var(--color-primary);
      font-family: var(--font-mono);
      font-weight: bold;
    }

    .subtitle {
      color: var(--color-text-secondary);
      font-size: var(--font-size-xl);
      font-style: italic;
    }

    .subsubtitle {
      color: var(--color-text-secondary);
      font-family: var(--font-mono);
      width: 75%;
      margin: 0 auto;
      font-size: var(--font-size-lg);
      font-style: italic;
      background-color: var(--color-bg-light);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      text-wrap: balance;
    }

    .progress {
      text-align: center;
      align-content: center;
      color: var(--color-text-secondary);
      font-size: var(--font-size-base);
      height: var(--spacing-4xl);
    }


    .code-block {
      width: 100%;
      background-color: var(--color-code-bg);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      font-family: var(--font-mono);
      font-size: 1.25rem;
      color: var(--color-text-primary);
      overflow-x: auto;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, calc(var(--shadow-strength) * 0.6));
      max-width: 600px;
      text-align: center;
      text-wrap: nowrap;
    }

    .syntax-keyword {
      color: var(--syntax-keyword);
      font-weight: bold;
    }

    .syntax-string {
      color: var(--syntax-string);
    }

    .syntax-number {
      color: var(--syntax-number);
    }

    .syntax-operator {
      color: var(--syntax-operator);
    }

    .syntax-function {
      color: var(--syntax-function);
      font-weight: bold;
    }

    .syntax-comment {
      color: var(--syntax-comment);
      font-style: italic;
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-lg);
      max-width: 600px;
      margin: 0 auto;
    }

    .option {
      background-color: var(--color-bg-light);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg) var(--spacing-xl);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--spacing-lg);
      position: relative;
      font-size: var(--font-size-base);
    }

    .option:hover:not(.disabled) {
      background-color: var(--color-bg-lighter);
      border-color: var(--color-border-hover);
      transform: translateY(-1px);
    }

    .option.selected {
      border-color: var(--color-primary);
      background-color: rgba(230, 159, 0, 0.15);
    }

    .option.correct {
      border-color: var(--color-accent-green);
      background-color: var(--color-correct-bg);
    }

    .option.incorrect {
      border-color: var(--color-error);
      background-color: var(--color-incorrect-bg);
    }

    .option.disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }

    .option-key {
      background-color: var(--color-border-light);
      color: var(--color-text-primary);
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
      font-size: var(--font-size-base);
    }

    .option-text {
      font-family: var(--font-mono);
      flex: 1;
      font-weight: bold;
    }

    .explanation {
      max-width: 600px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 1rem;
      padding: var(--spacing-lg);
      background-color: var(--color-bg-light);
      border-radius: var(--radius-md);
      border-left: var(--border-thick) solid var(--color-accent-green);
      visibility: hidden;
      font-size: var(--font-size-lg);
      text-wrap: balance;
      width: 100%;
      min-height: 6rem;
    }

    .explanation.correct {
      border-left-color: var(--color-accent-green);
      background-color: var(--color-correct-bg);
    }

    .explanation.incorrect {
      border-left-color: var(--color-error);
      background-color: var(--color-incorrect-bg);
    }


    .button {
      background-color: var(--color-primary);
      color: var(--color-bg-dark);
      border: none;
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg) var(--spacing-3xl);
      font-size: var(--font-size-lg);
      font-weight: bold;
      cursor: pointer;
      max-width: 250px;
      width: 100%;
    }

    .button:hover {
      background-color: var(--color-primary-hover);
    }


    .start-screen,
    .results-screen {
      text-align: center;
    }

    .results-screen h2 {
      font-size: 3rem;
      margin-bottom: var(--spacing-4xl);
      color: var(--color-primary);
    }

    .score {
      font-size: 5rem;
      margin: var(--spacing-4xl) 0;
      color: var(--color-primary);
      font-weight: bold;
    }

    .share-button {
      background-color: var(--color-secondary);
      margin-top: var(--spacing-xl);
    }

    .share-button:hover {
      background-color: var(--color-secondary-hover);
    }

    .hidden {
      display: none;
    }

    .timezone-note {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin-top: calc(var(--spacing-sm) + 2px);
      font-style: italic;
    }

    @media (max-width: 600px) {
      body {
        padding: var(--spacing-sm);
      }

      /* Reduce padding on mobile screens to maximize content area */
      #startScreen,
      #quizScreen,
      #resultsScreen {
        padding: var(--spacing-md);
      }

      h1 {
        font-size: 2.5rem;
      }

      .subtitle {
        font-size: var(--font-size-lg);
      }

      .subsubtitle {
        font-size: var(--font-size-base);
      }

      .code-block {
        font-size: var(--font-size-base);
        padding: var(--spacing-lg);
      }

      .options {
        gap: var(--spacing-md);
      }

      .option {
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: var(--font-size-sm);
      }

      .option-key {
        width: 28px;
        height: 28px;
        font-size: var(--font-size-sm);
      }

      .button {
        font-size: var(--font-size-base);
        max-width: 200px;
      }

      .progress {
        font-size: var(--font-size-sm);
      }

      .score {
        font-size: 3rem;
      }

      .results-screen h2 {
        font-size: 2rem;
      }
    }

    .toast {
      position: fixed;
      bottom: var(--spacing-xl);
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--color-primary);
      color: var(--color-bg-dark);
      padding: var(--spacing-md) calc(var(--spacing-xl) + var(--spacing-xs));
      border-radius: var(--radius-md);
      font-weight: bold;
      opacity: 0;
    }

    .toast.show {
      opacity: 1;
    }

    .theme-toggle {
      position: fixed;
      top: var(--spacing-xl);
      right: var(--spacing-xl);
      background-color: var(--color-bg-light);
      border: var(--border-medium) solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-sm) var(--spacing-md);
      cursor: pointer;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-size: var(--font-size-base);
      color: var(--color-text-primary);
    }

    .theme-toggle:hover {
      background-color: var(--color-bg-lighter);
      border-color: var(--color-border-hover);
      transform: translateY(-1px);
    }

    .theme-toggle:active {
      transform: translateY(0);
    }

    .theme-icon {
      width: 20px;
      height: 20px;
      display: block;
    }

    [data-theme="light"] .moon-icon {
      display: none;
    }

    [data-theme="dark"] .sun-icon,
    :root:not([data-theme]) .sun-icon {
      display: none;
    }

    @media (max-width: 600px) {
      .theme-toggle {
        top: var(--spacing-md);
        right: var(--spacing-md);
        padding: var(--spacing-xs) var(--spacing-sm);
      }
    }
  </style>
</head>

<body>
  <!-- Theme toggle button -->
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
    <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
    <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>

  <div class="container">
    <div id="startScreen" class="start-screen">
      <header>
        <h1 id="main-title">new Date("wtf")</h1>
        <p class="subtitle">A quiz about the most bizarre date parser I've ever seen</p>
      </header>

      <p class="subsubtitle">
        All questions verified using NodeJS 24.4.0 on
        a MacBook Pro set to the BST timezone (UTC+1).
      </p>
      <button class="button" onclick="startQuiz()">Start Quiz</button>
    </div>

    <div id="quizScreen" class="hidden">
      <div class="progress">
        Question <span id="currentQuestion">1</span> of <span id="totalQuestions">20</span>
      </div>

      <div class="code-block" id="codeBlock"></div>
      <div id="timezoneNote" class="timezone-note hidden"></div>
      <div class="explanation" id="explanation"></div>

      <div class="options" id="options"></div>

      <button id="nextButton" class="button hidden" onclick="nextQuestion()">Next Question</button>
    </div>

    <div id="resultsScreen" class="results-screen hidden">
      <h2>Quiz Complete!</h2>
      <div class="score">
        <span id="correctCount">0</span> / <span id="totalCount">0</span>
      </div>
      <p id="resultMessage"></p>
      <button class="button share-button" onclick="shareResults()">Share Results</button>
      <button class="button" onclick="restartQuiz()">Try Again</button>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    function getTheme() {
      return localStorage.getItem('theme') || 'dark';
    }

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
    }

    function toggleTheme() {
      const currentTheme = getTheme();
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      setTheme(newTheme);
    }

    // URL-based progress tracking
    function updateURL() {
      const params = new URLSearchParams();
      if (currentQuestionIndex > 0) {
        params.set('q', currentQuestionIndex.toString());
      }
      if (score > 0) {
        params.set('s', score.toString());
      }
      if (chosenAnswer !== null) {
        params.set('a', chosenAnswer.toString());
      }
      const newURL = params.toString() ? `?${params.toString()}` : window.location.pathname;
      window.history.replaceState({}, '', newURL);
    }

    function loadFromURL() {
      const params = new URLSearchParams(window.location.search);
      const questionParam = params.get('q');
      const scoreParam = params.get('s');
      const answerParam = params.get('a');

      if (questionParam) {
        const questionIndex = parseInt(questionParam);
        if (questionIndex >= 0 && questionIndex < questions.length) {
          currentQuestionIndex = questionIndex;
          score = parseInt(scoreParam) || 0;
          const savedAnswer = answerParam !== null ? parseInt(answerParam) : null;

          // Set chosenAnswer before calling startQuiz
          chosenAnswer = savedAnswer;

          startQuiz(true);

          // If there's a chosen answer, simulate the answer selection
          if (savedAnswer !== null && savedAnswer >= 0 && savedAnswer <= 3) {
            setTimeout(() => {
              selectOption(savedAnswer);
            }, 100); // Small delay to ensure DOM is ready
          }
          return true;
        }
      }
      return false;
    }

    document.addEventListener('DOMContentLoaded', () => {
      setTheme(getTheme());
      const mainTitle = document.getElementById('main-title');
      if (mainTitle) {
        mainTitle.innerHTML = highlightJS('new Date("wtf")');
      }

      // Load progress from URL if available
      if (!loadFromURL()) {
        // Show start screen if no URL params
        document.getElementById('startScreen').classList.remove('hidden');
      }
    });

    setTheme(getTheme());

    function highlightJS(code) {
      const keywords = new Set([
        'new', 'function', 'var', 'let', 'const', 'if', 'else', 'for', 'while', 'do',
        'switch', 'case', 'break', 'continue', 'return', 'try', 'catch', 'finally',
        'throw', 'typeof', 'instanceof', 'in', 'of', 'class', 'extends', 'super',
        'static', 'import', 'export', 'from', 'default', 'async', 'await', 'yield',
        'delete', 'void', 'this', 'null', 'undefined', 'true', 'false'
      ]);

      const operators = new Set([
        '+', '-', '*', '/', '%', '=', '!', '<', '>', '&', '|', '^', '~', '?', ':',
        ';', ',', '.', '(', ')', '[', ']', '{', '}'
      ]);

      function tokenize(code) {
        const tokens = [];
        let i = 0;

        while (i < code.length) {
          const char = code[i];

          if (/\s/.test(char)) {
            let whitespace = '';
            while (i < code.length && /\s/.test(code[i])) {
              whitespace += code[i];
              i++;
            }
            tokens.push({ type: 'whitespace', value: whitespace });
            continue;
          }

          if (char === '"' || char === "'") {
            const quote = char;
            let string = char;
            i++;

            while (i < code.length && code[i] !== quote) {
              if (code[i] === '\\' && i + 1 < code.length) {
                string += code[i] + code[i + 1];
                i += 2;
              } else {
                string += code[i];
                i++;
              }
            }

            if (i < code.length) {
              string += code[i];
              i++;
            }

            tokens.push({ type: 'string', value: string });
            continue;
          }

          if (/\d/.test(char)) {
            let number = '';
            while (i < code.length && /[\d.]/.test(code[i])) {
              number += code[i];
              i++;
            }
            tokens.push({ type: 'number', value: number });
            continue;
          }

          if (/[a-zA-Z_$]/.test(char)) {
            let identifier = '';
            while (i < code.length && /[a-zA-Z0-9_$]/.test(code[i])) {
              identifier += code[i];
              i++;
            }

            const builtinConstructors = new Set(['Date', 'Array', 'Object', 'String', 'Number', 'Boolean', 'RegExp', 'Math', 'JSON']);

            let j = i;
            while (j < code.length && /\s/.test(code[j])) j++;

            if (keywords.has(identifier)) {
              tokens.push({ type: 'keyword', value: identifier });
            } else if (builtinConstructors.has(identifier)) {
              tokens.push({ type: 'function', value: identifier });
            } else if (j < code.length && code[j] === '(') {
              tokens.push({ type: 'function', value: identifier });
            } else {
              tokens.push({ type: 'identifier', value: identifier });
            }
            continue;
          }

          if (operators.has(char)) {
            tokens.push({ type: 'operator', value: char });
            i++;
            continue;
          }

          tokens.push({ type: 'other', value: char });
          i++;
        }

        return tokens;
      }

      function tokensToHtml(tokens) {
        return tokens.map(token => {
          switch (token.type) {
            case 'keyword':
              return `<span class="syntax-keyword">${token.value}</span>`;
            case 'string':
              return `<span class="syntax-string">${token.value}</span>`;
            case 'number':
              return `<span class="syntax-number">${token.value}</span>`;
            case 'function':
              return `<span class="syntax-function">${token.value}</span>`;
            case 'operator':
              return `<span class="syntax-operator">${token.value}</span>`;
            default:
              return token.value;
          }
        }).join('');
      }

      const tokens = tokenize(code);
      return tokensToHtml(tokens);
    }

    const rawQuestions = [
      {
        code: 'new Date("0")',
        options: [
          '1970-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date',
          'Throws an error'
        ],
        correct: 1,
        explanation: 'The string "0" is interpreted as the year 2000, not as a timestamp!'
      },
      {
        code: 'new Date(0)',
        options: [
          '1970-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date',
          'Throws an error'
        ],
        correct: 0,
        explanation: 'The number 0 is interpreted as milliseconds since the Unix epoch (Jan 1, 1970).'
      },
      {
        code: 'Date.parse(0) === Date.parse("0")',
        options: [
          'true',
          'false',
          'Throws an error',
          'undefined'
        ],
        correct: 0,
        explanation: 'Both parse to 946684800000 milliseconds! The number 0 is coerced to the string "0".'
      },

      {
        code: 'new Date("not a date")',
        options: [
          'null',
          'undefined',
          'Invalid Date',
          'Throws an error'
        ],
        correct: 2,
        explanation: 'Invalid Date is still a Date object! It\'s not null or an error.'
      },
      {
        code: 'new Date("not a date").getTime()',
        options: [
          '0',
          'NaN',
          'null',
          'Throws an error'
        ],
        correct: 1,
        explanation: 'Invalid Date objects return NaN for getTime().'
      },
      {
        code: 'new Date("not a date").toISOString()',
        options: [
          '"Invalid Date"',
          'null',
          'NaN',
          'Throws a RangeError'
        ],
        correct: 3,
        explanation: 'toISOString() throws a RangeError on Invalid Date objects.'
      },
      {
        code: 'new Date("not a date").toTimeString()',
        options: [
          '"Invalid Date"',
          '""',
          'null',
          'Throws an error'
        ],
        correct: 0,
        explanation: 'toTimeString() returns the string "Invalid Date" for invalid dates.'
      },

      {
        code: 'new Date("1")',
        options: [
          '1970-01-01T00:00:01.000Z',
          '2001-01-01T00:00:00.000Z',
          '0001-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 1,
        explanation: 'Just like "0", "1" is interpreted as year 2001, not as a timestamp!'
      },
      {
        code: 'new Date("2")',
        options: [
          '2002-01-01T00:00:00.000Z',
          '2001-01-02T00:00:00.000Z',
          '2001-02-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 2,
        explanation: 'For reasons not obvious to me, "2" is interpreted as February 2001 (month 2).'
      },
      {
        code: 'new Date("99") > new Date("100")',
        options: [
          'true',
          'false',
          'Throws an error',
          'Both are Invalid Date'
        ],
        correct: 0,
        explanation: '"99" is year 1999, while "100" is year 0100. 1999 > 0100!'
      },
      {
        code: 'new Date("13")',
        options: [
          '2013-01-01T00:00:00.000Z',
          '2001-01-13T00:00:00.000Z',
          '2001-13-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 3,
        explanation: '"13" would be month 13, which doesn\'t exist, so it\'s Invalid Date.'
      },
      {
        code: 'new Date("12")',
        options: [
          '2012-01-01T00:00:00.000Z',
          '2001-01-12T00:00:00.000Z',
          '2001-12-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 2,
        explanation: '"12" is interpreted as December 2001 (month 12).'
      },

      {
        code: 'new Date("12.0")',
        options: [
          '2012-01-01T00:00:00.000Z',
          '2001-12-01T00:00:00.000Z',
          '2001-01-12T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 3,
        explanation: 'Adding ".0" makes it invalid, even though 12.0 === 12 in JavaScript!'
      },
      {
        code: 'new Date("12.1")',
        options: [
          '2001-12-01T00:00:00.100Z',
          '2001-01-01T00:00:00.000Z',
          '2012-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 1,
        explanation: '"12.1" is somehow valid and gives January 2001. The parser gives up on the decimal.'
      },

      {
        code: 'new Date("perhaps 1")',
        options: [
          'Invalid Date',
          '2001-01-01T00:00:00.000Z',
          '1970-01-01T00:00:01.000Z',
          'Throws an error'
        ],
        correct: 1,
        explanation: 'Leading text is ignored! It finds the "1" and parses it as year 2001.'
      },
      {
        code: 'new Date("maybe 1")',
        options: [
          '2001-01-01T00:00:00.000Z',
          '2001-04-30T23:00:00.000Z',
          '2001-05-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 1,
        explanation: '"may" in "maybe" is parsed as the month May! Then "be 1" becomes day 1.',
        timezoneNote: 'Note: The exact time may vary based on your timezone.'
      },
      {
        code: 'new Date("fourth of may 2010")',
        options: [
          'Invalid Date',
          '2010-05-04T00:00:00.000Z',
          '2010-04-30T23:00:00.000Z',
          '2010-05-01T00:00:00.000Z'
        ],
        correct: 2,
        explanation: 'It parses "fourth" as 4, finds "may" as the month, and 2010 as the year.',
        timezoneNote: 'Note: The exact time may vary based on your timezone.'
      },

      {
        code: 'new Date("1990 2010")',
        options: [
          '1990-01-01T00:00:00.000Z',
          '2010-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 3,
        explanation: 'Two years without parentheses confuses the parser - Invalid Date.'
      },
      {
        code: 'new Date("1990 (2010)")',
        options: [
          '1990-01-01T00:00:00.000Z',
          '2010-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 0,
        explanation: 'Parentheses make the parser ignore what\'s inside! Uses 1990.'
      },
      {
        code: 'new Date("(1990) 2010")',
        options: [
          '1990-01-01T00:00:00.000Z',
          '2010-01-01T00:00:00.000Z',
          '2000-01-01T00:00:00.000Z',
          'Invalid Date'
        ],
        correct: 1,
        explanation: 'With the first year in parentheses, it\'s ignored and 2010 is used!'
      }
    ];

    const questions = rawQuestions.map(question => ({
      ...question,
      highlightedCode: highlightJS(question.code)
    }));

    let currentQuestionIndex = 0;
    let score = 0;
    let answered = false;
    let chosenAnswer = null;

    function startQuiz(skipURLUpdate = false) {
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('quizScreen').classList.remove('hidden');
      document.getElementById('totalQuestions').textContent = questions.length;
      showQuestion(skipURLUpdate); // Preserve answer if we're skipping URL update
      if (!skipURLUpdate) {
        updateURL();
      }
    }

    function showQuestion(preserveAnswer = false) {
      const question = questions[currentQuestionIndex];
      document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
      document.getElementById('codeBlock').innerHTML = question.highlightedCode;

      const optionsContainer = document.getElementById('options');
      optionsContainer.innerHTML = '';

      question.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option';
        optionDiv.onclick = () => selectOption(index);

        const keyDiv = document.createElement('div');
        keyDiv.className = 'option-key';
        keyDiv.textContent = (index + 1).toString();

        const textDiv = document.createElement('div');
        textDiv.className = 'option-text';
        textDiv.textContent = option;

        optionDiv.appendChild(keyDiv);
        optionDiv.appendChild(textDiv);
        optionsContainer.appendChild(optionDiv);
      });

      const explanation = document.getElementById('explanation');
      explanation.classList.remove('correct', 'incorrect');
      explanation.style.visibility = 'hidden';
      document.getElementById('nextButton').classList.add('hidden');

      if (question.timezoneNote) {
        document.getElementById('timezoneNote').textContent = question.timezoneNote;
        document.getElementById('timezoneNote').classList.remove('hidden');
      } else {
        document.getElementById('timezoneNote').classList.add('hidden');
      }

      answered = false;
      if (!preserveAnswer) {
        chosenAnswer = null;
      }
    }

    function selectOption(index) {
      if (answered) return;

      answered = true;
      chosenAnswer = index;
      const question = questions[currentQuestionIndex];
      const options = document.querySelectorAll('.option');

      options[index].classList.add('selected');

      const isCorrect = index === question.correct;

      if (isCorrect) {
        options[index].classList.add('correct');
        score++;
      } else {
        options[index].classList.add('incorrect');
        options[question.correct].classList.add('correct');
      }

      options.forEach(option => option.classList.add('disabled'));

      const explanation = document.getElementById('explanation');
      explanation.innerHTML = question.explanation;
      explanation.style.visibility = 'visible';
      explanation.classList.add(isCorrect ? 'correct' : 'incorrect');

      document.getElementById('nextButton').classList.remove('hidden');
      updateURL();
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        showQuestion();
        updateURL();
      } else {
        showResults();
      }
    }

    function showResults() {
      document.getElementById('quizScreen').classList.add('hidden');
      document.getElementById('resultsScreen').classList.remove('hidden');
      document.getElementById('correctCount').textContent = score;
      document.getElementById('totalCount').textContent = questions.length;

      const percentage = Math.round((score / questions.length) * 100);
      let message = '';

      if (percentage === 100) {
        message = 'Perfect! You truly understand the madness of JavaScript dates!';
      } else if (percentage >= 80) {
        message = 'Excellent! You know your way around Date weirdness.';
      } else if (percentage >= 60) {
        message = 'Good job! JavaScript dates are tricky.';
      } else if (percentage >= 40) {
        message = 'Not bad! Date parsing is genuinely confusing.';
      } else {
        message = 'JavaScript dates are weird, aren\'t they?';
      }

      document.getElementById('resultMessage').textContent = message;
      // Clear URL parameters when quiz is complete
      window.history.replaceState({}, '', window.location.pathname);
    }

    function shareResults() {
      const score = document.getElementById('correctCount').textContent;
      const total = document.getElementById('totalCount').textContent;
      const text = `I scored ${score}/${total} on the JavaScript Date WTF Quiz! 🗓️\n\nThink you know JS dates? Try it at jsdate.wtf`;

      if (navigator.share) {
        navigator.share({
          text: text
        });
      } else {
        navigator.clipboard.writeText(text);
        showToast('Results copied to clipboard!');
      }
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function restartQuiz() {
      currentQuestionIndex = 0;
      score = 0;
      chosenAnswer = null;
      document.getElementById('resultsScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
      // Clear URL parameters
      window.history.replaceState({}, '', window.location.pathname);
    }

    document.addEventListener('keydown', (e) => {
      if (document.getElementById('quizScreen').classList.contains('hidden')) return;

      if (e.key >= '1' && e.key <= '4' && !answered) {
        selectOption(parseInt(e.key) - 1);
      } else if ((e.key === 'Enter' || e.key === ' ') && answered) {
        e.preventDefault();
        nextQuestion();
      }
    });
  </script>
</body>

</html>
